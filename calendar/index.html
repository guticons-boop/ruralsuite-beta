<script>
    function renderLists() {
        const resContainer = document.getElementById('lista-reservas');
        const limpContainer = document.getElementById('lista-limpiezas');
        resContainer.innerHTML = '';
        limpContainer.innerHTML = '';

        reservas.forEach(res => {
            // Render de Próximas Estancias
            resContainer.innerHTML += `
                <div class="bg-white p-6 rounded-[35px] border border-gray-50 shadow-sm flex justify-between items-center group">
                    <div class="flex items-center gap-4">
                        <div class="w-2 h-10 rounded-full ${res.limpio ? 'bg-emerald-500' : 'bg-orange-500'}"></div>
                        <div>
                            <h4 class="font-black text-sm text-slate-900">${res.cliente}</h4>
                            <p class="text-[10px] font-bold text-slate-400 uppercase">${res.propiedad}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-6">
                        <div class="text-right">
                            <p class="text-[10px] font-black text-slate-900 uppercase">${formatDate(res.entrada)} - ${formatDate(res.salida)}</p>
                        </div>
                        <button onclick="compartirWhatsApp('${res.propiedad}')" class="p-3 bg-emerald-50 text-emerald-700 rounded-2xl hover:bg-emerald-900 hover:text-white transition">
                            <i data-lucide="share-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            `;

            // Render de Limpiezas (Módulo Oscuro)
            if(!res.limpio) {
                limpContainer.innerHTML += `
                    <div class="bg-white/5 p-5 rounded-[30px] border border-white/10 flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-orange-500/20 text-orange-500 rounded-xl flex items-center justify-center">
                                <i data-lucide="utensils" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="font-bold text-xs">${res.propiedad}</p>
                                <p class="text-[9px] font-bold text-white/40 uppercase">Check-out: ${formatDate(res.salida)}</p>
                            </div>
                        </div>
                        <button onclick="toggleLimpieza(${res.id})" class="px-4 py-2 bg-white text-emerald-950 rounded-xl font-black text-[9px] uppercase tracking-tighter">Marcar Listo</button>
                    </div>
                `;
            }
        });
        lucide.createIcons();
    }

    function formatDate(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleDateString('es-ES', { day: '2-digit', month: 'short' });
    }

    function toggleLimpieza(id) {
        const res = reservas.find(r => r.id === id);
        res.limpio = !res.limpio;
        localStorage.setItem('rural_reservas', JSON.stringify(reservas));
        render();
    }

    // FUNCIÓN MAGICA: COMPARTIR CON LIMPIEZA
    function compartirWhatsApp(propiedad) {
        // En un caso real, aquí iría la URL pública de tu app 'limpieza.html'
        const urlLimpieza = window.location.origin + "/limpieza.html?prop=" + encodeURIComponent(propiedad);
        const mensaje = `Hola! Aquí tienes el acceso al calendario de limpieza para: ${propiedad}. Puedes ver las entradas/salidas y marcar cuando esté listo aquí: ${urlLimpieza}`;
        
        const waUrl = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
        window.open(waUrl, '_blank');
    }

    function abrirModal() { document.getElementById('modal-reserva').classList.remove('hidden'); }
    function cerrarModal() { document.getElementById('modal-reserva').classList.add('hidden'); }

    function guardarReserva() {
        const res = {
            id: Date.now(),
            cliente: document.getElementById('cliente').value,
            propiedad: document.getElementById('propiedad').value,
            entrada: document.getElementById('entrada').value,
            salida: document.getElementById('salida').value,
            limpio: false
        };
        reservas.push(res);
        localStorage.setItem('rural_reservas', JSON.stringify(reservas));
        cerrarModal();
        render();
    }

    render();
</script>
