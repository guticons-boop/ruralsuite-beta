<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Check-in Pro | RuralGesto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@1,900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #f9f9f9; }
        .italic-black { font-style: italic; font-weight: 900; letter-spacing: -1px; }
        .form-input { width: 100%; padding: 15px; border-radius: 15px; border: 1px solid #eee; margin-bottom: 10px; font-weight: 600; font-size: 14px; outline: none; }
        .form-input:focus { border-color: #000; }
        #reader { width: 100%; border-radius: 20px; overflow: hidden; display: none; }
    </style>
</head>
<body class="p-6">

    <header class="mb-8 flex justify-between items-center">
        <button onclick="location.href='/hub/'" class="text-xs font-black text-gray-300 italic uppercase">‚Üê Volver</button>
        <h1 class="italic-black text-2xl uppercase">Check-in Pro</h1>
    </header>

    <div id="actions" class="grid grid-cols-1 gap-4 mb-8">
        <button onclick="startScanner()" class="bg-black text-white p-6 rounded-[30px] flex items-center justify-between shadow-xl">
            <div class="text-left">
                <p class="italic-black text-lg uppercase">Escanear DNI</p>
                <p class="text-[10px] font-bold opacity-50 uppercase">Uso presencial (C√°mara)</p>
            </div>
            <span class="text-2xl">üì∏</span>
        </button>

        <button onclick="shareLink()" class="bg-white border-2 border-black p-6 rounded-[30px] flex items-center justify-between">
            <div class="text-left">
                <p class="italic-black text-lg uppercase text-black">Enviar Enlace</p>
                <p class="text-[10px] font-bold text-gray-400 uppercase">Para que el cliente lo rellene</p>
            </div>
            <span class="text-2xl">üîó</span>
        </button>
    </div>

    <div id="reader" class="mb-6"></div>

    <div id="checkin-form" class="bg-white p-8 rounded-[40px] shadow-sm border border-gray-100">
        <h3 class="italic-black uppercase mb-6 text-sm text-blue-600 tracking-widest">Datos del Viajero</h3>
        
        <label class="text-[10px] font-black uppercase ml-2 text-gray-400">Nombre Completo</label>
        <input type="text" id="fname" placeholder="Nombre y Apellidos" class="form-input">

        <label class="text-[10px] font-black uppercase ml-2 text-gray-400">N√∫mero de Documento</label>
        <input type="text" id="doc_num" placeholder="DNI / Pasaporte" class="form-input">

        <label class="text-[10px] font-black uppercase ml-2 text-gray-400">Fecha de Expedici√≥n</label>
        <input type="date" id="doc_date" class="form-input">

        <label class="text-[10px] font-black uppercase ml-2 text-gray-400">Tipo de Documento</label>
        <select id="doc_type" class="form-input">
            <option value="D">DNI / NIE</option>
            <option value="P">Pasaporte</option>
        </select>

        <button onclick="saveCheckin()" class="w-full bg-blue-600 text-white p-5 rounded-2xl font-black italic uppercase mt-4 shadow-lg shadow-blue-100">Registrar Entrada</button>
    </div>

    <script>
        // Funci√≥n para simular el esc√°ner (abre la c√°mara)
        function startScanner() {
            const readerDiv = document.getElementById('reader');
            readerDiv.style.display = 'block';
            
            const html5QrCode = new Html5Qrcode("reader");
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };

            html5QrCode.start({ facingMode: "environment" }, config, (decodedText) => {
                // Aqu√≠ ir√≠a la l√≥gica de procesar el c√≥digo del DNI
                alert("Documento detectado: " + decodedText);
                html5QrCode.stop();
                readerDiv.style.display = 'none';
            }).catch(err => {
                alert("C√°mara activada. Enfoca el c√≥digo del DNI.");
            });
        }

        // Funci√≥n para compartir el enlace con el cliente
        function shareLink() {
            const url = window.location.href + "?mode=client"; // Enviamos el enlace a esta misma p√°gina pero modo cliente
            const text = "Hola! Bienvenido a El Rinconcito. Por favor, completa tu registro legal aqu√≠: " + url;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
        }

        // Si entramos en modo cliente, ocultamos el bot√≥n de esc√°ner
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('mode') === 'client') {
            document.getElementById('actions').style.display = 'none';
            document.querySelector('h1').innerText = "Registro El Rinconcito";
        }

        function saveCheckin() {
            alert("Registro guardado y listo para enviar a las autoridades.");
            location.href = '/hub/';
        }
    </script>
</body>
</html>
