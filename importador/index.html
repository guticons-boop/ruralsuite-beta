<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Importador | RuralGesto</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfdfb; }
        .serif { font-family: 'DM+Serif+Display', serif; }
        .drop-active { border-color: #be123c; background-color: #fff1f2; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-2xl mx-auto">
        <header class="flex items-center gap-4 mb-10">
            <button onclick="location.href='../hub/index.html'" class="p-4 bg-white rounded-3xl shadow-sm border border-gray-100"><i data-lucide="arrow-left"></i></button>
            <div>
                <h2 class="serif text-3xl italic text-rose-950 font-bold">Importar Reservas</h2>
                <p class="text-[9px] font-black uppercase tracking-widest text-rose-600 italic">Sincronización Excel RuralGesto</p>
            </div>
        </header>

        <div class="bg-white p-10 rounded-[50px] border border-slate-100 shadow-sm space-y-8 text-center">
            <div id="drop-zone" class="border-2 border-dashed border-slate-200 rounded-[40px] p-16 transition-all cursor-pointer relative hover:bg-slate-50">
                <input type="file" id="file-input" class="absolute inset-0 opacity-0 cursor-pointer" accept=".xlsx, .xls">
                
                <div id="status-initial">
                    <div class="w-20 h-20 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="file-up" class="text-rose-600 w-10 h-10"></i>
                    </div>
                    <p class="serif text-xl italic font-bold text-slate-800">Suelta tu Excel aquí</p>
                    <p class="text-[10px] font-black uppercase text-slate-400 mt-2 tracking-widest">O pulsa para seleccionar archivo</p>
                </div>

                <div id="status-success" class="hidden">
                    <div class="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="check-circle-2" class="text-emerald-600 w-10 h-10"></i>
                    </div>
                    <p class="serif text-xl italic font-bold text-emerald-800">¡Archivo cargado!</p>
                    <p id="row-count" class="text-[10px] font-black uppercase text-emerald-600 mt-2 tracking-widest">0 RESERVAS DETECTADAS</p>
                </div>
            </div>

            <div class="space-y-4">
                <button id="btn-confirmar" class="hidden w-full py-6 bg-slate-900 text-white rounded-[30px] font-black text-[10px] uppercase tracking-widest shadow-xl transition-all hover:bg-rose-900">
                    Procesar e importar ahora
                </button>
                <p class="text-[9px] text-slate-400 font-bold uppercase italic tracking-tighter">Compatible con Booking, Airbnb y plantillas personalizadas</p>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        const statusInitial = document.getElementById('status-initial');
        const statusSuccess = document.getElementById('status-success');
        const btnConfirmar = document.getElementById('btn-confirmar');
        const rowCountText = document.getElementById('row-count');

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const json = XLSX.utils.sheet_to_json(sheet);
                        
                        // UI Update
                        statusInitial.classList.add('hidden');
                        statusSuccess.classList.remove('hidden');
                        btnConfirmar.classList.remove('hidden');
                        rowCountText.innerText = json.length + " RESERVAS ENCONTRADAS";
                    } catch (err) {
                        alert("Error al leer el Excel. Asegúrate de que no está protegido con contraseña.");
                    }
                };
                reader.readAsArrayBuffer(file);
            }
        });

        // Drag & Drop visual feedback
        ['dragenter', 'dragover'].forEach(name => {
            dropZone.addEventListener(name, () => dropZone.classList.add('drop-active'));
        });
        ['dragleave', 'drop'].forEach(name => {
            dropZone.addEventListener(name, () => dropZone.classList.remove('drop-active'));
        });
    </script>
</body>
</html>
