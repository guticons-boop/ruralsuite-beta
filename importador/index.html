<script>
    // ... (Mantén el resto del código igual, solo actualizamos la función de procesado)

    function procesarYGuardar() {
        const datosFinales = datosTemporales.map(r => {
            // Unimos NOMBRE + APELLIDO 1 de tu Excel
            const nombreCompleto = `${r['NOMBRE'] || ''} ${r['APELLIDO 1'] || ''}`.trim();
            
            // Mapeo según la foto que me has pasado
            return {
                cliente: nombreCompleto || 'Cliente Sin Nombre',
                // Buscamos la columna de email (parece que es la que tiene la @)
                email: r['yolandasan'] || r['email'] || 'Sin Email', 
                // Buscamos la columna del teléfono (la que empieza por 6 o 34)
                movil: r['686586692'] || r['TELEFONO'] || '000000000',
                // Fecha de nacimiento para marketing de cumpleaños
                nacimiento: r['25/05/1995'] || r['FECHA NACIMIENTO'] || '',
                // Fecha de entrada
                fechaEntrada: r['06/12/2024'] || r['ENTRADA'] || '',
                apartamento: r['El Rinconcit'] || 'Apartamento',
                localizador: 'RG-' + Math.floor(1000 + Math.random() * 9000)
            };
        });
        
        localStorage.setItem('reservas_ruralgesto', JSON.stringify(datosFinales));
        alert("¡Éxito! Se han procesado los nombres, emails, teléfonos y fechas de nacimiento.");
        switchTab('checkins');
    }

    function renderizarDatos() {
        const data = JSON.parse(localStorage.getItem('reservas_ruralgesto') || '[]');
        const lista = document.getElementById('lista-reservas');
        const tablaClientes = document.getElementById('tabla-clientes-body');
        
        lista.innerHTML = '';
        tablaClientes.innerHTML = '';

        data.forEach(reserva => {
            // Render en Check-ins
            lista.innerHTML += `
                <div class="bg-white p-6 rounded-[30px] border border-slate-100 shadow-sm flex justify-between items-center">
                    <div>
                        <h4 class="font-bold text-sm text-slate-800">${reserva.cliente}</h4>
                        <p class="text-[9px] font-black text-rose-600 uppercase italic">${reserva.apartamento} • Entra: ${reserva.fechaEntrada}</p>
                    </div>
                    <button onclick="enviarWA('${reserva.movil}', '${reserva.apartamento}', '${reserva.localizador}')" class="p-3 bg-emerald-50 text-emerald-600 rounded-xl">
                        <i data-lucide="send" class="w-4 h-4"></i>
                    </button>
                </div>`;
            
            // Render en Base de Datos de Clientes (con Fecha de Nacimiento)
            tablaClientes.innerHTML += `
                <tr class="border-b border-slate-50">
                    <td class="p-4">
                        <p class="font-bold text-slate-700">${reserva.cliente}</p>
                        <p class="text-[8px] text-slate-400">${reserva.email}</p>
                    </td>
                    <td class="p-4 font-mono text-slate-500">${reserva.movil}</td>
                    <td class="p-4 text-[10px] text-rose-600 font-bold italic">${reserva.nacimiento}</td>
                </tr>`;
        });
        lucide.createIcons();
    }
</script>
