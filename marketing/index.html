<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Marketing Pro | RuralGesto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@1,900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #fcfcfc; color: #1a1a1a; }
        .italic-black { font-style: italic; font-weight: 900; letter-spacing: -1px; }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #eee; transition: .4s; border-radius: 24px; }
        input:checked + .slider { background-color: #3b82f6; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider:before { transform: translateX(20px); }
        .card-campaign { background: white; border-radius: 30px; padding: 24px; border: 1.5px solid #f2f2f2; transition: 0.3s; }
        .active-campaign { border-color: #3b82f6; background: #f8fbff; }
    </style>
</head>
<body class="p-6 max-w-lg mx-auto">

    <header class="mb-10 flex justify-between items-center">
        <button onclick="location.href='/hub/'" class="text-[10px] font-black text-gray-400 italic uppercase tracking-widest border border-gray-200 px-4 py-2 rounded-full">‚Üê Volver</button>
        <h1 class="italic-black text-2xl uppercase tracking-tighter text-blue-600">Marketing CRM</h1>
    </header>

    <div class="bg-black text-white p-8 rounded-[40px] mb-8 shadow-2xl relative overflow-hidden">
        <div class="relative z-10">
            <p class="text-[10px] font-black uppercase tracking-[0.2em] text-gray-500 mb-2 italic">Audiencia Total</p>
            <h2 id="total-clients" class="text-5xl italic-black">0</h2>
            <p class="text-[10px] font-bold text-blue-400 mt-4 uppercase italic">Sincronizado con Check-in Pro</p>
        </div>
        <div class="absolute right-[-20px] bottom-[-20px] text-9xl opacity-10 italic-black">@</div>
    </div>

    <section class="space-y-4 mb-12">
        <h3 class="italic-black uppercase text-xs text-gray-400 tracking-widest ml-4 mb-4 italic text-center">Configurar Campa√±as Autom√°ticas</h3>
        
        <div class="card-campaign flex items-center justify-between" id="card-cumple">
            <div>
                <h4 class="font-black italic text-lg uppercase leading-none">Felicitar Cumplea√±os</h4>
                <p class="text-[10px] font-bold text-gray-400 uppercase mt-1 italic">Cup√≥n 10% dto. autom√°tico</p>
            </div>
            <label class="switch">
                <input type="checkbox" id="check-cumple" onchange="toggleCampaign('cumple')">
                <span class="slider"></span>
            </label>
        </div>

        <div class="card-campaign flex items-center justify-between" id="card-navidad">
            <div>
                <h4 class="font-black italic text-lg uppercase leading-none">Campa√±a Navidad</h4>
                <p class="text-[10px] font-bold text-gray-400 uppercase mt-1 italic">Env√≠o masivo 15 de dic.</p>
            </div>
            <label class="switch">
                <input type="checkbox" id="check-navidad" onchange="toggleCampaign('navidad')">
                <span class="slider"></span>
            </label>
        </div>

        <div class="card-campaign flex items-center justify-between" id="card-baja">
            <div>
                <h4 class="font-black italic text-lg uppercase leading-none">Escapada Matarra√±a</h4>
                <p class="text-[10px] font-bold text-gray-400 uppercase mt-1 italic">Promoci√≥n entre semana</p>
            </div>
            <label class="switch">
                <input type="checkbox" id="check-baja" onchange="toggleCampaign('baja')">
                <span class="slider"></span>
            </label>
        </div>
    </section>

    <section>
        <h3 class="italic-black uppercase text-xs text-gray-400 tracking-widest ml-4 mb-4 italic text-center text-center">Acciones Recomendadas Hoy</h3>
        <div id="action-list" class="space-y-3">
            </div>
    </section>

    <script>
        // Cargamos los clientes del Check-in para tener la base de datos sincronizada
        let clients = JSON.parse(localStorage.getItem('rg_checkins')) || [];
        document.getElementById('total-clients').innerText = clients.length;

        // Guardar estado de campa√±as
        function toggleCampaign(id) {
            const isChecked = document.getElementById('check-'+id).checked;
            const card = document.getElementById('card-'+id);
            if(isChecked) card.classList.add('active-campaign');
            else card.classList.remove('active-campaign');
            localStorage.setItem('camp_'+id, isChecked);
            renderActions();
        }

        function renderActions() {
            const list = document.getElementById('action-list');
            list.innerHTML = "";
            const today = new Date().toISOString().slice(5, 10); // MM-DD
            
            let actionsCount = 0;

            clients.forEach(c => {
                // L√≥gica de Cumplea√±os (si la campa√±a est√° activa)
                if(localStorage.getItem('camp_cumple') === 'true') {
                    // Nota: En un caso real comparar√≠amos con la fecha de nacimiento. 
                    // Como en el checkin pedimos fecha expedici√≥n, aqu√≠ simulamos una detecci√≥n.
                    // Para el ejemplo, si no tiene fecha nacimiento, usamos una fecha fija de prueba
                    const esCumple = c.expedicion && c.expedicion.slice(5,10) === today; 
                    
                    if(esCumple) {
                        actionsCount++;
                        list.innerHTML += `
                            <div class="bg-yellow-50 border-2 border-yellow-100 p-6 rounded-[30px] flex justify-between items-center">
                                <div>
                                    <p class="font-black italic text-yellow-800">üéÇ ¬°CUMPLEA√ëOS DE ${c.nombre.toUpperCase()}!</p>
                                    <p class="text-[9px] font-bold text-yellow-600 uppercase italic">Enviar regalo: C√≥digo Rinconcito10</p>
                                </div>
                                <button onclick="sendPromo('${c.nombre}', 'cumple')" class="bg-yellow-400 p-3 rounded-2xl text-xl shadow-md">‚úâÔ∏è</button>
                            </div>`;
                    }
                }
            });

            if(actionsCount === 0) {
                list.innerHTML = `<p class="text-center text-gray-300 italic text-sm py-10">No hay acciones pendientes hoy.<br>Activa campa√±as para ver sugerencias.</p>`;
            }
        }

        function sendPromo(nombre, tipo) {
            let msg = "";
            if(tipo === 'cumple') {
                msg = `¬°Hola ${nombre}! üëã Desde El Rinconcito Matarra√±a te deseamos un muy feliz cumplea√±os. üéÇ Queremos celebrarlo contigo regal√°ndote un 10% de descuento para tu pr√≥xima escapada. C√≥digo: RICONCITO10. ¬°Te esperamos!`;
            }
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
        }

        // Cargar estados guardados
        ['cumple', 'navidad', 'baja'].forEach(id => {
            if(localStorage.getItem('camp_'+id) === 'true') {
                document.getElementById('check-'+id).checked = true;
                document.getElementById('card-'+id).classList.add('active-campaign');
            }
        });

        renderActions();
    </script>
</body>
</html>
