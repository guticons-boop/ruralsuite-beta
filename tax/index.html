<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración | RuralGesto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfdfb; color: #1a1a1a; overflow-x: hidden; }
        .serif { font-family: 'DM+Serif+Display', serif; }
        /* Clases de utilidad para el control de pestañas */
        .seccion-admin { display: none; }
        .seccion-admin.activa { display: block; animation: fadeIn 0.3s ease-in-out; }
        .tab-btn.activo { border-bottom: 2px solid #1a1a1a; color: #1a1a1a !important; opacity: 1; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Acordeones */
        .acordeon-contenido { max-height: 0; overflow: hidden; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0; }
        .acordeon-contenido.abierto { max-height: 1000px; opacity: 1; padding-top: 1.5rem; padding-bottom: 1.5rem; }
    </style>
</head>
<body class="p-6 md:p-12 pb-32">
    <div class="max-w-5xl mx-auto">
        
        <header class="flex flex-col md:flex-row justify-between items-center gap-6 mb-16">
            <button onclick="window.location.href='../hub/index.html'" class="p-5 bg-white rounded-3xl border border-slate-100 shadow-sm hover:shadow-md transition-all">
                <i data-lucide="arrow-left" class="w-6 h-6 text-rose-950"></i>
            </button>
            
            <div class="flex flex-wrap justify-center gap-4">
                <div class="flex bg-slate-100 p-1.5 rounded-2xl" id="grupo-periodo">
                    <button onclick="cambiarFiltro('periodo', 'sem', this)" class="filtro-btn px-6 py-2 text-[10px] font-black uppercase tracking-widest text-slate-400">Semanal</button>
                    <button onclick="cambiarFiltro('periodo', 'mes', this)" class="filtro-btn px-6 py-2 bg-white shadow-sm rounded-xl text-[10px] font-black uppercase tracking-widest text-rose-950">Mensual</button>
                </div>
                <div class="flex bg-slate-100 p-1.5 rounded-2xl" id="grupo-iva">
                    <button onclick="cambiarFiltro('iva', 'sin', this)" class="filtro-btn px-6 py-2 bg-white shadow-sm rounded-xl text-[10px] font-black uppercase tracking-widest text-rose-950">Sin IVA</button>
                    <button onclick="cambiarFiltro('iva', 'con', this)" class="filtro-btn px-6 py-2 text-[10px] font-black uppercase tracking-widest text-slate-400">Con IVA</button>
                </div>
            </div>
        </header>

        <nav class="flex gap-8 md:gap-12 mb-12 border-b border-slate-100 overflow-x-auto whitespace-nowrap">
            <button onclick="irAPestana('resumen')" id="btn-resumen" class="tab-btn activo pb-6 text-[10px] font-black uppercase tracking-widest text-slate-400">Resumen Desglosado</button>
            <button onclick="irAPestana('graficos')" id="btn-graficos" class="tab-btn pb-6 text-[10px] font-black uppercase tracking-widest text-slate-400">Rendimiento Visual</button>
            <button onclick="irAPestana('fiscal')" id="btn-fiscal" class="tab-btn pb-6 text-[10px] font-black uppercase tracking-widest text-slate-400">Borrador Fiscal</button>
        </nav>

        <div id="pantalla-resumen" class="seccion-admin activa space-y-6">
            <div class="bg-white rounded-[35px] border border-slate-100 overflow-hidden shadow-sm hover:border-rose-100 transition-colors">
                <div onclick="toggleAcordeon('detalles-tirolina')" class="p-8 flex justify-between items-center cursor-pointer">
                    <div>
                        <h4 class="serif text-3xl italic text-rose-950">La Tirolina</h4>
                        <div class="flex gap-4 mt-2">
                            <span class="text-[8px] font-black text-rose-900 bg-rose-50 px-2 py-1 rounded uppercase">Bruto: <span id="bruto-t">1850</span>€</span>
                            <span class="text-[8px] font-black text-slate-400 bg-slate-50 px-2 py-1 rounded uppercase">Comisión Media: 18%</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-[9px] font-black text-slate-300 uppercase block mb-1">Neto Final</span>
                        <span id="neto-t" class="serif text-4xl italic text-rose-950 transition-all">1517€</span>
                    </div>
                </div>
                <div id="detalles-tirolina" class="acordeon-contenido px-8 bg-slate-50/30">
                    <div class="space-y-4 border-t border-slate-100 pt-6 pb-4">
                        <div class="flex justify-between text-xs"><span>05/01 - Reserva Booking (4 noches)</span><span class="font-bold">720,00€</span></div>
                        <div class="flex justify-between text-xs"><span>12/01 - Venta Directa (2 noches)</span><span class="font-bold">380,00€</span></div>
                        <div class="flex justify-between text-xs"><span>20/01 - Reserva Airbnb (5 noches)</span><span class="font-bold">750,00€</span></div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-[35px] border border-slate-100 overflow-hidden shadow-sm">
                <div onclick="toggleAcordeon('detalles-ermita')" class="p-8 flex justify-between items-center cursor-pointer">
                    <div>
                        <h4 class="serif text-3xl italic text-rose-950">La Ermita</h4>
                        <div class="flex gap-4 mt-2">
                            <span class="text-[8px] font-black text-rose-900 bg-rose-50 px-2 py-1 rounded uppercase">Bruto: 1200€</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-[9px] font-black text-slate-300 uppercase block mb-1">Neto Final</span>
                        <span id="neto-e" class="serif text-4xl italic text-rose-950">1056€</span>
                    </div>
                </div>
                <div id="detalles-ermita" class="acordeon-contenido px-8 bg-slate-50/30">
                    <div class="p-4 text-center text-xs text-slate-400 italic">No hay más gastos registrados en este periodo.</div>
                </div>
            </div>
        </div>

        <div id="pantalla-graficos" class="seccion-admin space-y-8">
            <div class="bg-white p-12 rounded-[50px] border border-slate-100 text-center shadow-sm">
                <h3 class="serif text-4xl italic text-rose-950 mb-12">Análisis de Ocupación</h3>
                <div class="max-w-[280px] mx-auto relative">
                    <canvas id="graficoCircular"></canvas>
                </div>
                <div class="flex justify-center gap-8 mt-16">
                    <div class="text-center"><div class="w-8 h-2 bg-[#bfdbfe] rounded-full mx-auto mb-2"></div><p class="text-[8px] font-black uppercase text-slate-400 tracking-widest">Tirolina</p></div>
                    <div class="text-center"><div class="w-8 h-2 bg-[#fed7aa] rounded-full mx-auto mb-2"></div><p class="text-[8px] font-black uppercase text-slate-400 tracking-widest">Ermita</p></div>
                    <div class="text-center"><div class="w-8 h-2 bg-[#fef08a] rounded-full mx-auto mb-2"></div><p class="text-[8px] font-black uppercase text-slate-400 tracking-widest">Almendros</p></div>
                </div>
            </div>
        </div>

        <div id="pantalla-fiscal" class="seccion-admin space-y-8">
            <div class="bg-white p-12 rounded-[50px] border border-slate-100 shadow-sm">
                <div class="flex gap-4 mb-12" id="grupo-perfil">
                    <button onclick="seleccionarPerfil('part', this)" class="perfil-btn flex-1 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all">Particular</button>
                    <button onclick="seleccionarPerfil('auto', this)" class="perfil-btn flex-1 py-4 bg-slate-50 text-slate-400 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all">Autónomo</button>
                    <button onclick="seleccionarPerfil('emp', this)" class="perfil-btn flex-1 py-4 bg-slate-50 text-slate-400 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all">Empresa</button>
                </div>
                
                <form class="grid grid-cols-1 md:grid-cols-2 gap-8" onsubmit="return false;">
                    <div class="space-y-2">
                        <label class="text-[9px] font-black uppercase text-slate-300 ml-4">Nombre Declarante / Razón Social</label>
                        <input type="text" value="El Rinconcito del Matarraña" class="w-full p-5 bg-slate-50 rounded-2xl font-bold outline-none focus:ring-2 ring-rose-100">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[9px] font-black uppercase text-slate-300 ml-4">NIF / CIF</label>
                        <input type="text" value="B-12345678" class="w-full p-5 bg-slate-50 rounded-2xl font-mono outline-none focus:ring-2 ring-rose-100">
                    </div>
                    <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
                        <button class="py-6 border border-slate-100 rounded-full text-[9px] font-black uppercase tracking-[0.2em] hover:bg-slate-50 flex items-center justify-center gap-3 transition-all">
                            <i data-lucide="download" class="w-4 h-4"></i> Generar Excel Gestor
                        </button>
                        <button class="py-6 bg-rose-950 text-white rounded-full text-[9px] font-black uppercase tracking-[0.2em] shadow-xl shadow-rose-950/20 hover:scale-[1.02] transition-all">
                            Enviar Borrador Renta
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // === INICIALIZACIÓN ===
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });

        // === LÓGICA DE PESTAÑAS (AUDITADA) ===
        function irAPestana(idDestino) {
            // 1. Ocultar todas las secciones
            document.querySelectorAll('.seccion-admin').forEach(sec => sec.classList.remove('activa'));
            // 2. Desactivar todos los botones de la nav
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('activo'));

            // 3. Activar la sección y el botón correspondiente
            document.getElementById('pantalla-' + idDestino).classList.add('activa');
            document.getElementById('btn-' + idDestino).classList.add('activo');

            // 4. Si es la pestaña de gráficos, lanzar el renderizado
            if (idDestino === 'graficos') {
                setTimeout(inicializarGrafico, 100); // Pequeño delay para asegurar visibilidad del canvas
            }
        }

        // === LÓGICA DE ACORDEONES ===
        function toggleAcordeon(id) {
            const el = document.getElementById(id);
            el.classList.toggle('abierto');
        }

        // === FILTROS SUPERIORES (PERIODOS E IVA) ===
        function cambiarFiltro(grupo, valor, elemento) {
            // Estética de los botones del grupo
            const contenedor = elemento.parentElement;
            contenedor.querySelectorAll('.filtro-btn').forEach(btn => {
                btn.className = "filtro-btn px-6 py-2 text-[10px] font-black uppercase tracking-widest text-slate
