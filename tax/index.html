<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Administración | RuralGestión</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #fdfdfb; }
        .serif { font-family: 'DM+Serif+Display', serif; }
        .tab-active { color: #064e3b; border-bottom: 3px solid #064e3b; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="p-4 md:p-8 pb-24">

    <div class="max-w-2xl mx-auto">
        <header class="flex justify-between items-center mb-8">
            <button onclick="location.href='../hub/index.html'" class="p-3 bg-white rounded-2xl shadow-sm border border-gray-100">
                <i data-lucide="arrow-left" class="w-5 h-5 text-gray-400"></i>
            </button>
            <h2 class="serif text-2xl italic text-emerald-900 font-bold">Administración</h2>
            <div class="w-10"></div>
        </header>

        <div class="flex border-b border-gray-100 mb-8 justify-between px-2">
            <button onclick="changeTab('graficos')" id="btn-graficos" class="pb-4 text-[10px] font-black uppercase tracking-widest text-gray-400 tab-active">Análisis</button>
            <button onclick="changeTab('registros')" id="btn-registros" class="pb-4 text-[10px] font-black uppercase tracking-widest text-gray-400">Ingresos/Gastos</button>
            <button onclick="changeTab('renta')" id="btn-renta" class="pb-4 text-[10px] font-black uppercase tracking-widest text-gray-400">Borrador Renta</button>
        </div>

        <div id="tab-graficos" class="space-y-6">
            <div class="bg-white p-6 rounded-[40px] shadow-sm border border-gray-50">
                <canvas id="myChart" height="200"></canvas>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-emerald-900 p-6 rounded-[35px] text-white">
                    <p class="text-[9px] font-bold uppercase opacity-60 tracking-widest">Beneficio Neto</p>
                    <p class="text-2xl font-black mt-1">4.250€</p>
                </div>
                <div class="bg-white p-6 rounded-[35px] border border-gray-100">
                    <p class="text-[9px] font-bold uppercase text-gray-400 tracking-widest italic">Ahorro IRPF (19%)</p>
                    <p class="text-2xl font-black mt-1 text-emerald-900">807€</p>
                </div>
            </div>
        </div>

        <div id="tab-registros" class="hidden space-y-6">
            <div class="bg-white p-8 rounded-[40px] shadow-sm border border-gray-50 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <input type="date" id="fecha" class="p-4 bg-gray-50 rounded-2xl font-bold text-xs outline-none">
                    <select id="tipo" class="p-4 bg-gray-50 rounded-2xl font-bold text-xs outline-none">
                        <option value="ingreso">Ingreso (+)</option>
                        <option value="gasto">Gasto (-)</option>
                    </select>
                </div>
                <input type="text" id="concepto" placeholder="Concepto (Ej: Luz, Reserva Airbnb...)" class="w-full p-4 bg-gray-50 rounded-2xl font-bold text-sm outline-none">
                <input type="number" id="importe" placeholder="Importe (€)" class="w-full p-4 bg-gray-50 rounded-2xl font-bold text-sm outline-none">
                <button onclick="addRegistro()" class="w-full py-4 bg-emerald-900 text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-lg">Añadir Movimiento</button>
            </div>
            <div id="lista-movimientos" class="space-y-2">
                </div>
        </div>

        <div id="tab-renta" class="hidden space-y-6">
            <div class="bg-emerald-50 p-8 rounded-[40px] border border-emerald-100">
                <h3 class="serif text-2xl text-emerald-900 mb-2 italic">Preparar Renta</h3>
                <p class="text-[10px] text-emerald-700 font-bold uppercase tracking-widest mb-6">Resumen para tu gestor</p>
                
                <div class="space-y-4 bg-white p-6 rounded-3xl">
                    <div class="flex justify-between text-sm border-b border-gray-50 pb-2">
                        <span class="text-gray-400 font-bold">Total Ingresos</span>
                        <span class="font-black text-emerald-900">12.450€</span>
                    </div>
                    <div class="flex justify-between text-sm border-b border-gray-50 pb-2">
                        <span class="text-gray-400 font-bold">Gastos Deducibles</span>
                        <span class="font-black text-red-500">-2.100€</span>
                    </div>
                    <div class="flex justify-between text-sm font-black text-lg pt-2">
                        <span>Base Imponible</span>
                        <span>10.350€</span>
                    </div>
                </div>

                <div class="mt-8 space-y-4">
                    <label class="text-[9px] font-black uppercase text-emerald-800 ml-2">Notas adicionales para el gestor</label>
                    <textarea placeholder="Ej: Incluir amortización del mobiliario..." class="w-full p-4 bg-white rounded-2xl text-sm h-32 outline-none border border-emerald-100"></textarea>
                </div>

                <button onclick="exportarDatos()" class="w-full mt-6 py-5 bg-emerald-900 text-white rounded-[25px] font-black uppercase text-[10px] tracking-widest shadow-xl flex items-center justify-center gap-3">
                    <i data-lucide="file-spreadsheet" class="w-4 h-4"></i> Generar Excel y Enviar
                </button>
            </div>
        </div>

    </div>

    <script>
        lucide.createIcons();
        
        // --- LÓGICA DE TABS ---
        function changeTab(tab) {
            ['graficos', 'registros', 'renta'].forEach(t => {
                document.getElementById('tab-' + t).classList.add('hidden');
                document.getElementById('btn-' + t).classList.remove('tab-active');
            });
            document.getElementById('tab-' + tab).classList.remove('hidden');
            document.getElementById('btn-' + tab).classList.add('tab-active');
            if(tab === 'graficos') initChart();
        }

        // --- GRÁFICOS ---
        function initChart() {
            const ctx = document.getElementById('myChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Ingresos',
                        data: [1200, 1900, 3000, 2500, 2200, 4200],
                        backgroundColor: '#1a4731',
                        borderRadius: 10
                    }]
                },
                options: { responsive: true, plugins: { legend: { display: false } } }
            });
        }

        // --- MOVIMIENTOS ---
        let movimientos = JSON.parse(localStorage.getItem('rural_movs')) || [];
        function addRegistro() {
            const m = {
                fecha: document.getElementById('fecha').value,
                tipo: document.getElementById('tipo').value,
                concepto: document.getElementById('concepto').value,
                importe: document.getElementById('importe').value
            };
            movimientos.push(m);
            localStorage.setItem('rural_movs', JSON.stringify(movimientos));
            renderMovs();
        }

        function renderMovs() {
            const list = document.getElementById('lista-movimientos');
            list.innerHTML = movimientos.map(m => `
                <div class="flex justify-between items-center bg-white p-4 rounded-2xl border border-gray-50">
                    <div>
                        <p class="text-[10px] font-bold text-gray-400 uppercase">${m.fecha}</p>
                        <p class="font-bold text-xs">${m.concepto}</p>
                    </div>
                    <p class="font-black ${m.tipo === 'ingreso' ? 'text-emerald-600' : 'text-red-500'}">${m.tipo === 'ingreso' ? '+' : '-'}${m.importe}€</p>
                </div>
            `).join('');
        }

        function exportarDatos() {
            alert("Generando informe consolidado para el gestor... (Excel/PDF)");
        }

        // Inicio
        initChart();
        renderMovs();
    </script>
</body>
</html>
