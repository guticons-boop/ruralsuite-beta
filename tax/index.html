<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración | RuralGesto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfdfb; color: #1a1a1a; }
        .serif { font-family: 'DM+Serif+Display', serif; }
        
        /* Sistema de Pestañas */
        .seccion-contenido { display: none; }
        .seccion-contenido.activa { display: block; animation: fadeIn 0.4s ease; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Botones de Navegación */
        .nav-btn { border-bottom: 2px solid transparent; transition: all 0.3s; color: #94a3b8; }
        .nav-btn.activo { border-bottom: 2px solid #1a1a1a; color: #1a1a1a; }

        /* Acordeones */
        .acordeon-lista { max-height: 0; overflow: hidden; transition: all 0.5s cubic-bezier(0, 1, 0, 1); }
        .acordeon-lista.abierto { max-height: 2000px; transition: all 0.5s cubic-bezier(1, 0, 1, 0); border-top: 1px solid #f1f5f9; margin-top: 1.5rem; padding-top: 1.5rem; }
    </style>
</head>
<body class="p-6 md:p-12 pb-32">
    <div class="max-w-5xl mx-auto">
        
        <header class="flex flex-col md:flex-row justify-between items-center gap-6 mb-12">
            <button onclick="window.history.back()" class="p-5 bg-white rounded-3xl border border-slate-100 shadow-sm hover:bg-slate-50">
                <i data-lucide="arrow-left" class="w-6 h-6 text-rose-950"></i>
            </button>
            
            <div class="flex flex-wrap gap-4">
                <div class="flex bg-slate-100 p-1.5 rounded-2xl">
                    <button id="p-sem" onclick="cambiarPeriodo('sem')" class="px-6 py-2 text-[10px] font-black uppercase tracking-widest text-slate-400 transition-all">Semanal</button>
                    <button id="p-mes" onclick="cambiarPeriodo('mes')" class="px-6 py-2 bg-white shadow-sm rounded-xl text-[10px] font-black uppercase tracking-widest text-rose-950">Mensual</button>
                </div>
                <div class="flex bg-slate-100 p-1.5 rounded-2xl">
                    <button id="v-sin" onclick="cambiarIVA(false)" class="px-6 py-2 bg-white shadow-sm rounded-xl text-[10px] font-black uppercase tracking-widest text-rose-950 transition-all">Sin IVA</button>
                    <button id="v-con" onclick="cambiarIVA(true)" class="px-6 py-2 text-[10px] font-black uppercase tracking-widest text-slate-400 transition-all">Con IVA</button>
                </div>
            </div>
        </header>

        <nav class="flex gap-8 md:gap-12 mb-12 border-b border-slate-100 overflow-x-auto">
            <button onclick="cambiarPestana('resumen')" id="tab-resumen" class="nav-btn activo pb-6 text-[10px] font-black uppercase tracking-widest">Resumen Desglosado</button>
            <button onclick="cambiarPestana('graficos')" id="tab-graficos" class="nav-btn pb-6 text-[10px] font-black uppercase tracking-widest">Rendimiento Visual</button>
            <button onclick="cambiarPestana('fiscal')" id="tab-fiscal" class="nav-btn pb-6 text-[10px] font-black uppercase tracking-widest">Borrador Fiscal</button>
        </nav>

        <div id="sec-resumen" class="seccion-contenido activa space-y-6">
            
            <div class="bg-white rounded-[35px] border border-slate-100 overflow-hidden shadow-sm">
                <div onclick="toggleApartamento('det-tirolina')" class="p-8 flex justify-between items-center cursor-pointer hover:bg-slate-50">
                    <div>
                        <h4 class="serif text-3xl italic text-rose-950">La Tirolina</h4>
                        <p class="text-[9px] font-black text-slate-400 uppercase mt-2 tracking-widest">Comisión Booking: 18% aplicada</p>
                    </div>
                    <div class="text-right">
                        <span class="text-[9px] font-black text-slate-300 uppercase block mb-1">Neto Final</span>
                        <span id="txt-t" class="serif text-4xl italic text-rose-950">1.517€</span>
                    </div>
                </div>
                <div id="det-tirolina" class="acordeon-lista px-8">
                    <div class="space-y-4 pb-6">
                        <div class="flex justify-between text-xs"><span>Reserva #8821 - Booking.com</span><span class="font-bold">720,00€</span></div>
                        <div class="flex justify-between text-xs"><span>Reserva #8834 - Venta Directa</span><span class="font-bold">380,00€</span></div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-[35px] border border-slate-100 overflow-hidden shadow-sm">
                <div onclick="toggleApartamento('det-ermita')" class="p-8 flex justify-between items-center cursor-pointer hover:bg-slate-50">
                    <div>
                        <h4 class="serif text-3xl italic text-rose-950">La Ermita</h4>
                        <p class="text-[9px] font-black text-slate-400 uppercase mt-2 tracking-widest">Comisión Airbnb: 12% aplicada</p>
                    </div>
                    <div class="text-right">
                        <span class="text-[9px] font-black text-slate-300 uppercase block mb-1">Neto Final</span>
                        <span id="txt-e" class="serif text-4xl italic text-rose-950">1.056€</span>
                    </div>
                </div>
                <div id="det-ermita" class="acordeon-lista px-8">
                    <div class="space-y-4 pb-6 text-xs text-slate-400 italic">Cargando histórico de reservas...</div>
                </div>
            </div>

            <div class="bg-white rounded-[35px] border border-slate-100 overflow-hidden shadow-sm">
                <div onclick="toggleApartamento('det-almendros')" class="p-8 flex justify-between items-center cursor-pointer hover:bg-slate-50">
                    <div>
                        <h4 class="serif text-3xl italic text-rose-950">Los Almendros</h4>
                        <p class="text-[9px] font-black text-slate-400 uppercase mt-2 tracking-widest">Venta Directa: 0% Comisión</p>
                    </div>
                    <div class="text-right">
                        <span class="text-[9px] font-black text-slate-300 uppercase block mb-1">Neto Final</span>
                        <span id="txt-a" class="serif text-4xl italic text-rose-950">840€</span>
                    </div>
                </div>
                <div id="det-almendros" class="acordeon-lista px-8">
                    <div class="space-y-4 pb-6 text-xs text-slate-400 italic">No hay registros este periodo.</div>
                </div>
            </div>

        </div>

        <div id="sec-graficos" class="seccion-contenido">
            <div class="bg-white p-12 rounded-[50px] border border-slate-100 shadow-sm text-center">
                <h3 class="serif text-4xl italic text-rose-950 mb-12">Rendimiento por Propiedad</h3>
                <div class="max-w-[280px] mx-auto">
                    <canvas id="miGrafico"></canvas>
                </div>
                <div class="flex justify-center gap-8 mt-16">
                    <div class="text-center"><div class="w-8 h-2 bg-[#bfdbfe] rounded-full mx-auto mb-2"></div><p class="text-[8px] font-black uppercase text-slate-400">Tirolina</p></div>
                    <div class="text-center"><div class="w-8 h-2 bg-[#fed7aa] rounded-full mx-auto mb-2"></div><p class="text-[8px] font-black uppercase text-slate-400">Ermita</p></div>
                    <div class="text-center"><div class="w-8 h-2 bg-[#fef08a] rounded-full mx-auto mb-2"></div><p class="text-[8px] font-black uppercase text-slate-400">Almendros</p></div>
                </div>
            </div>
        </div>

        <div id="sec-fiscal" class="seccion-contenido">
            <div class="bg-white p-12 rounded-[50px] border border-slate-100 shadow-sm">
                <div class="flex gap-4 mb-12">
                    <button onclick="setPerfil('p')" id="btn-p" class="flex-1 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase">Particular</button>
                    <button onclick="setPerfil('a')" id="btn-a" class="flex-1 py-4 bg-slate-50 text-slate-400 rounded-2xl text-[10px] font-black uppercase">Autónomo</button>
                    <button onclick="setPerfil('e')" id="btn-e" class="flex-1 py-4 bg-slate-50 text-slate-400 rounded-2xl text-[10px] font-black uppercase">Empresa</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-slate-300 ml-4 uppercase">Razón Social</label>
                        <input type="text" value="El Rinconcito del Matarraña" class="w-full p-5 bg-slate-50 rounded-2xl font-bold outline-none">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-slate-300 ml-4 uppercase">NIF / CIF</label>
                        <input type="text" value="B-12345678" class="w-full p-5 bg-slate-50 rounded-2xl font-mono outline-none">
                    </div>
                    <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
                        <button class="py-6 border border-slate-100 rounded-full text-[9px] font-black uppercase">Generar Excel</button>
                        <button class="py-6 bg-rose-950 text-white rounded-full text-[9px] font-black uppercase shadow-xl">Enviar al Gestor</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // === INICIALIZACIÓN ===
        window.onload = () => { lucide.createIcons(); };

        // === CAMBIO DE PESTAÑAS (CORREGIDO) ===
        function cambiarPestana(id) {
            // Ocultar todas
            document.getElementById('sec-resumen').style.display = 'none';
            document.getElementById('sec-graficos').style.display = 'none';
            document.getElementById('sec-fiscal').style.display = 'none';
            
            // Quitar activos de los botones
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('activo'));

            // Mostrar la actual
            const destino = document.getElementById('sec-' + id);
            destino.style.display = 'block';
            document.getElementById('tab-' + id).classList.add('activo');

            if(id === 'graficos') renderizarChart();
        }

        // === ACORDEONES (CORREGIDO) ===
        function toggleApartamento(id) {
            const el = document.getElementById(id);
            el.classList.toggle('abierto');
        }

        // === FILTROS SUPERIORES ===
        function cambiarPeriodo(p) {
            const s = document.getElementById('p-sem');
            const m = document.getElementById('p-mes');
            if(p === 'sem') {
                s.className = "px-6 py-2 bg-white shadow-sm rounded-xl text-[10px] font-black uppercase text-rose-950";
                m.className = "px-6 py-2 text-[10px] font-black uppercase text-slate-400";
            } else {
                m.className = "px-6 py-2 bg-white shadow-sm rounded-xl text-[10px] font-black uppercase text-rose-950";
                s.className = "px-6 py-2 text-[10px] font-black uppercase text-slate-400";
            }
        }

        function cambiarIVA(act) {
            const vSin = document.getElementById('v-sin');
            const vCon = document.getElementById('v-con');
            if(act) {
                vCon.className = "px-6 py-2 bg-white shadow-sm rounded-xl text-[10px] font-black uppercase text-rose-950";
                vSin.className = "px-6 py-2 text-[10px] font-black uppercase text-slate-400";
                document.getElementById('txt-t').innerText = "1669€";
                document.getElementById('txt-e').innerText = "1162€";
                document.getElementById('txt-a').innerText = "924€";
            } else {
                vSin.className = "px-6 py-2 bg-white shadow-sm rounded-xl text-[10px] font-black uppercase text-rose-950";
                vCon.className = "px-6 py-2 text-[10px] font-black uppercase text-slate-400";
                document.getElementById('txt-t').innerText = "1517€";
                document.getElementById('txt-e').innerText = "1056€";
                document.getElementById('txt-a').innerText = "840€";
            }
        }

        // === GRÁFICO (REVISADO) ===
        let chartObj = null;
        function renderizarChart() {
            const ctx = document.getElementById('miGrafico').getContext('2d');
            if(chartObj) chartObj.destroy();
            chartObj = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Tirolina', 'Ermita', 'Almendros'],
                    datasets: [{
                        data: [45, 30, 25],
                        backgroundColor: ['#bfdbfe', '#fed7aa', '#fef08a'],
                        borderWidth: 10, borderColor: '#ffffff'
                    }]
                },
                options: { plugins: { legend: { display: false } }, cutout: '75%' }
            });
        }

        // === PERFILES FISCALES ===
        function setPerfil(per) {
            const btnP = document.getElementById('btn-p');
            const btnA = document.getElementById('btn-a');
            const btnE = document.getElementById('btn-e');
            [btnP, btnA, btnE].forEach(b => b.className = "flex-1 py-4 bg-slate-50 text-slate-400 rounded-2xl text-[10px] font-black uppercase");
            document.getElementById('btn-' + per).className = "flex-1 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase";
        }
    </script>
</body>
</html>
