<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente Fiscal | RuralGesto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfdfb; }
        .serif { font-family: 'DM+Serif+Display', serif; }
        .tab-active { border-bottom: 4px solid #be123c; color: #be123c; }
        .card-green { background: #ecfdf5; color: #065f46; border: 1px solid #a7f3d0; }
        .card-red { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
        .card-blue { background: #eff6ff; color: #1e40af; border: 1px solid #bfdbfe; }
    </style>
</head>
<body class="p-4 md:p-8 pb-32">
    <div class="max-w-4xl mx-auto">
        <header class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-4">
                <button onclick="location.href='../hub/index.html'" class="p-4 bg-white rounded-3xl shadow-sm border border-gray-100"><i data-lucide="arrow-left"></i></button>
                <h2 class="serif text-3xl italic text-rose-950 font-bold italic">Asistente Fiscal</h2>
            </div>
            <button onclick="resetDatos()" class="p-2 text-slate-300 hover:text-rose-500"><i data-lucide="refresh-cw"></i></button>
        </header>

        <div class="flex border-b border-slate-100 mb-8">
            <button onclick="switchTax('ingresos')" id="btn-ingresos" class="flex-1 py-4 font-black text-[10px] uppercase tracking-widest tab-active">Ingresos</button>
            <button onclick="switchTax('gastos')" id="btn-gastos" class="flex-1 py-4 font-black text-[10px] uppercase tracking-widest text-slate-400">Gastos</button>
            <button onclick="switchTax('renta')" id="btn-renta" class="flex-1 py-4 font-black text-[10px] uppercase tracking-widest text-slate-400">Renta / IRPF</button>
        </div>

        <div class="grid grid-cols-3 h-4 rounded-full overflow-hidden mb-10 shadow-inner">
            <div id="bar-ingresos" class="bg-emerald-500 w-1/3"></div>
            <div id="bar-gastos" class="bg-rose-500 w-1/3"></div>
            <div id="bar-renta" class="bg-blue-500 w-1/3"></div>
        </div>

        <div id="view-ingresos" class="space-y-6">
            <div class="card-green p-8 rounded-[40px]">
                <p class="text-[10px] font-black uppercase opacity-60">Total Ingresos</p>
                <h3 id="total-val-ingresos" class="serif text-4xl font-bold mt-2">0,00 €</h3>
            </div>
            <div class="bg-white p-6 rounded-[30px] border border-slate-100 space-y-4">
                <input type="text" id="in-concepto" placeholder="Nombre Huésped / Reserva" class="w-full p-4 bg-slate-50 rounded-xl outline-none text-sm">
                <div class="flex gap-2">
                    <input type="number" id="in-importe" placeholder="Importe €" class="flex-1 p-4 bg-slate-50 rounded-xl outline-none text-sm">
                    <button onclick="addRegistro('ingreso')" class="px-8 bg-emerald-600 text-white rounded-xl font-black text-[10px] uppercase">Añadir</button>
                </div>
            </div>
            <div id="lista-ingresos" class="space-y-2"></div>
        </div>

        <div id="view-gastos" class="hidden space-y-6">
            <div class="card-red p-8 rounded-[40px]">
                <p class="text-[10px] font-black uppercase opacity-60">Total Gastos</p>
                <h3 id="total-val-gastos" class="serif text-4xl font-bold mt-2">0,00 €</h3>
            </div>
            <div class="bg-white p-6 rounded-[30px] border border-slate-100 space-y-4">
                <input type="text" id="ex-concepto" placeholder="Luz, Limpieza, Booking..." class="w-full p-4 bg-slate-50 rounded-xl outline-none text-sm">
                <div class="flex gap-2">
                    <input type="number" id="ex-importe" placeholder="Importe €" class="flex-1 p-4 bg-slate-50 rounded-xl outline-none text-sm">
                    <button onclick="addRegistro('gasto')" class="px-8 bg-rose-600 text-white rounded-xl font-black text-[10px] uppercase">Añadir</button>
                </div>
            </div>
            <div id="lista-gastos" class="space-y-2"></div>
        </div>

        <div id="view-renta" class="hidden space-y-6">
            <div class="card-blue p-8 rounded-[40px]">
                <p class="text-[10px] font-black uppercase opacity-60">Balance Fiscal Estimado</p>
                <h3 id="total-val-renta" class="serif text-4xl font-bold mt-2">0,00 €</h3>
            </div>
            <div class="bg-white p-8 rounded-[40px] border border-slate-100">
                <h4 class="serif text-xl italic font-bold mb-4">Declaración Renta 2026</h4>
                <div class="space-y-4 text-xs">
                    <div class="flex justify-between border-b pb-2"><span>Rendimiento Íntegro</span><span id="tax-bruto" class="font-bold">0 €</span></div>
                    <div class="flex justify-between border-b pb-2"><span>Gastos Deducibles</span><span id="tax-gastos" class="font-bold text-rose-500">0 €</span></div>
                    <div class="flex justify-between font-black text-blue-600 pt-2"><span>Base Imponible</span><span id="tax-base">0 €</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let data = JSON.parse(localStorage.getItem('fiscal_ruralgesto') || '{"ingresos":[], "gastos":[]}');

        function switchTax(view) {
            document.querySelectorAll('#view-ingresos, #view-gastos, #view-renta').forEach(v => v.classList.add('hidden'));
            document.querySelectorAll('nav button, .flex button').forEach(b => b.classList.remove('tab-active', 'text-slate-400'));
            document.getElementById('view-' + view).classList.remove('hidden');
            document.getElementById('btn-' + view).classList.add('tab-active');
            renderFiscal();
        }

        function addRegistro(tipo) {
            const concepto = document.getElementById(tipo === 'ingreso' ? 'in-concepto' : 'ex-concepto').value;
            const importe = parseFloat(document.getElementById(tipo === 'ingreso' ? 'in-importe' : 'ex-importe').value);
            if(!concepto || !importe) return;
            
            data[tipo === 'ingreso' ? 'ingresos' : 'gastos'].push({concepto, importe, fecha: new Date().toLocaleDateString()});
            localStorage.setItem('fiscal_ruralgesto', JSON.stringify(data));
            renderFiscal();
        }

        function renderFiscal() {
            let totalIn = 0; let totalEx = 0;
            const lIn = document.getElementById('lista-ingresos');
            const lEx = document.getElementById('lista-gastos');
            lIn.innerHTML = ''; lEx.innerHTML = '';

            data.ingresos.forEach(i => {
                totalIn += i.importe;
                lIn.innerHTML += `<div class="flex justify-between p-4 bg-white rounded-xl border border-slate-50 text-[11px] font-bold"><span>${i.concepto}</span><span class="text-emerald-600">+${i.importe}€</span></div>`;
            });
            data.gastos.forEach(e => {
                totalEx += e.importe;
                lEx.innerHTML += `<div class="flex justify-between p-4 bg-white rounded-xl border border-slate-50 text-[11px] font-bold"><span>${e.concepto}</span><span class="text-rose-600">-${e.importe}€</span></div>`;
            });

            document.getElementById('total-val-ingresos').innerText = totalIn.toFixed(2) + " €";
            document.getElementById('total-val-gastos').innerText = totalEx.toFixed(2) + " €";
            document.getElementById('total-val-renta').innerText = (totalIn - totalEx).toFixed(2) + " €";
            
            // Datos Renta
            document.getElementById('tax-bruto').innerText = totalIn.toFixed(2) + " €";
            document.getElementById('tax-gastos').innerText = totalEx.toFixed(2) + " €";
            document.getElementById('tax-base').innerText = (totalIn - totalEx).toFixed(2) + " €";

            lucide.createIcons();
        }

        function resetDatos() { if(confirm("¿Borrar fiscalidad?")) { localStorage.removeItem('fiscal_ruralgesto'); location.reload(); }}
        window.onload = renderFiscal;
    </script>
</body>
</html>
