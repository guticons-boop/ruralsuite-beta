<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tax Analytics | RuralGesto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@1,900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8f9fa; }
        .italic-black { font-style: italic; font-weight: 900; letter-spacing: -1px; }
        .card { background: white; border-radius: 30px; padding: 25px; border: 1px solid #eee; }
        .btn-export { padding: 10px 15px; border-radius: 12px; font-size: 9px; font-weight: 800; text-transform: uppercase; display: flex; align-items: center; gap: 5px; }
    </style>
</head>
<body class="p-6 max-w-lg mx-auto pb-32">

    <header class="mb-8 flex justify-between items-center">
        <button onclick="location.href='/hub/'" class="text-[10px] font-black text-gray-400 italic uppercase border border-gray-200 px-4 py-2 rounded-full">‚Üê Volver</button>
        <h1 class="italic-black text-2xl uppercase text-blue-600 italic">Finanzas</h1>
    </header>

    <div class="card shadow-xl mb-6">
        <h2 class="italic-black text-xs uppercase mb-6 text-gray-400 italic tracking-widest">Rendimiento por Propiedad</h2>
        <canvas id="incomeChart" width="400" height="300"></canvas>
    </div>

    <div class="flex gap-3 mb-8">
        <button onclick="exportExcel()" class="btn-export bg-green-100 text-green-700 flex-1 justify-center">
            <span>üìä</span> Exportar Excel
        </button>
        <button onclick="window.print()" class="btn-export bg-red-100 text-red-700 flex-1 justify-center">
            <span>üìÑ</span> Generar PDF
        </button>
    </div>

    <div class="card shadow-sm">
        <h3 class="italic-black text-xs uppercase mb-4 text-gray-400 italic">√öltimos Movimientos</h3>
        <div id="movimientos-list" class="space-y-3">
            </div>
    </div>

    <script>
        // Datos simulados (En la app real vendr√≠an del localStorage que llenas en el calendario)
        const dataStats = {
            labels: ['Apt 1', 'Suite Jard√≠n', 'Casa Piedra'],
            ingresos: [2450, 1800, 3200]
        };

        // Inicializar Gr√°fico
        function initChart() {
            const ctx = document.getElementById('incomeChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: dataStats.labels,
                    datasets: [{
                        data: dataStats.ingresos,
                        backgroundColor: ['#2563eb', '#10b981', '#f59e0b'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { weight: '900', size: 10 } } }
                    },
                    cutout: '70%'
                }
            });
        }

        // Exportar a Excel (CSV)
        function exportExcel() {
            let csvContent = "data:text/csv;charset=utf-8,Propiedad,Ingreso Neto,Fecha\n";
            dataStats.labels.forEach((label, i) => {
                csvContent += `${label},${dataStats.ingresos[i]},2026-01-19\n`;
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "RuralGesto_Tax_2026.csv");
            document.body.appendChild(link);
            link.click();
        }

        // Cargar lista visual
        function renderList() {
            const list = document.getElementById('movimientos-list');
            dataStats.labels.forEach((label, i) => {
                list.innerHTML += `
                    <div class="flex justify-between items-center border-b border-gray-50 pb-2">
                        <div>
                            <p class="font-black italic uppercase text-[10px]">${label}</p>
                            <p class="text-[8px] text-gray-400 uppercase font-bold">Reserva Finalizada</p>
                        </div>
                        <span class="font-black text-blue-600 text-sm">+${dataStats.ingresos[i]}‚Ç¨</span>
                    </div>
                `;
            });
        }

        initChart();
        renderList();
    </script>
</body>
</html>
